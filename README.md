–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è OpenVPN Connect 2FA –¥–ª—è macOS

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPN –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫—Ä—ã—à–∫–∏ –Ω–æ—É—Ç–±—É–∫–∞, –∏—Å–ø–æ–ª—å–∑—É—è —Å–∫—Ä–∏–ø—Ç –∏–∑ GitHub-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
üõ† –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (—á–µ—Ä–µ–∑ –¢–µ—Ä–º–∏–Ω–∞–ª)

–û—Ç–∫—Ä–æ–π—Ç–µ –¢–µ—Ä–º–∏–Ω–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —É—Ç–∏–ª–∏—Ç:
Bash

-- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Homebrew
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

-- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è 2FA –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è QR
brew install oath-toolkit zbar git

üîë –®–∞–≥ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞ –∏–∑ QR-–∫–æ–¥–∞

    –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç QR-–∫–æ–¥–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª –∫–∞–∫ qr.png.

    –í –¢–µ—Ä–º–∏–Ω–∞–ª–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
    Bash

    zbarimg ~/Desktop/qr.png

    –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ secret= (–Ω–∞–ø—Ä–∏–º–µ—Ä: 6APTQGIS...). –û–Ω–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞.

üìÇ –®–∞–≥ 3: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–¢–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –≤—Ä—É—á–Ω—É—é, –ø—Ä–æ—Å—Ç–æ —Å–∫–∞—á–∞–π—Ç–µ —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
Bash

-- –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª
cd ~/Desktop

-- –ö–ª–æ–Ω–∏—Ä—É–µ–º –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–∑–∞–º–µ–Ω–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–≤–æ—é)
git clone https://github.com/–í–ê–®_–õ–û–ì–ò–ù/–í–ê–®_–†–ï–ü–û–ó–ò–¢–û–†–ò–ô.git vpn_automation

-- –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É
cd vpn_automation

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª—é—á–∞:

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª vpn_auto.scpt –≤ –†–µ–¥–∞–∫—Ç–æ—Ä–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –í–ê–®_–°–ï–ö–†–ï–¢ –Ω–∞ —Ç–æ—Ç, —á—Ç–æ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ –≤ –®–∞–≥–µ 2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
‚è≥ –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Hammerspoon

    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Hammerspoon.

    –í –∫–æ–Ω—Ñ–∏–≥ Hammerspoon (Open Config) –≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏–∑ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–ø–∫–∏:

Lua

function runVPN()
    -- –ü—É—Ç—å –∫ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Å–∫—Ä–∏–ø—Ç—É
    local scriptPath = os.getenv("HOME") .. "/Desktop/vpn_automation/vpn_auto.scpt"

    hs.notify.new({title="VPN Automation", informativeText="–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Å–Ω—É–ª–∞—Å—å. –ü–æ–¥–∫–ª—é—á–∞—é..."}):send()
    hs.execute("osascript " .. scriptPath)
end

-- –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ–º
watcher = hs.caffeinate.watcher.new(function(event)
    if (event == hs.caffeinate.watcher.systemDidWake) then
        -- –ñ–¥–µ–º 6 —Å–µ–∫—É–Ω–¥ (—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è Wi-Fi)
        hs.timer.doAfter(6, runVPN)
    end
end)

watcher:start()

    –ù–∞–∂–º–∏—Ç–µ Save –∏ Reload Config –≤ –º–µ–Ω—é Hammerspoon.

üõ° –®–∞–≥ 5: –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ Hammerspoon –≤ —Å–∏—Å—Ç–µ–º–µ:
–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -> –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -> –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø.
